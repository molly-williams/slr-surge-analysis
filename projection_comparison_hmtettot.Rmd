---
title: "Surge Projection Comparison"
author: "Molly Williams"
date: "1/31/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Load packages
```{r}
library(tidyverse)
library(here)
library(readr)


```



# Import raw data from various climate models

```{r read_data}


files <- list.files(file.path(here()), pattern = ".txt")
#i = files[1]

for (i in 1:length(files)) {
  assign(files[i], read.table(files[i], 
                              header = FALSE,
                              col.names = c("YEAR","MONTH","DAY","HOUR","HTOT","HAST","HSLR",
                                            "HMETTOT","HMETSLP","HMETSST","HMETENSO", "HMETWIND")))
}


```


# Filter historical data to years of interest and select daily max only
## Could import and filter in a single step if we don't care about preserving the raw data in the environment (looks kind of messy...)

```{r}


# Create function to apply to all dfs

max_hist <- function(x, y, z, m) { # Inputs/parameters: x = df name, y = proj #, z = RCP, m = model
  proj_max <- x %>% 
  filter(YEAR > 1979) %>% 
  filter(YEAR < 2010) %>% 
  select(YEAR, MONTH, DAY, HMETTOT) %>%
  group_by(YEAR, MONTH, DAY) %>% 
  summarize(HMETTOTmax = max(HMETTOT)) %>% 
  ungroup() %>%
  mutate(PROJ = y) %>%  # add column for distinguishing projection
  mutate(RCP = z) %>% # add column for RCP
  mutate(GCM = m) # add column for GCM

}



  
proj01_max_hist <- max_hist(proj01_raw.txt, 01, 4.5, "ACCESS")
proj02_max_hist <- max_hist(proj02_raw.txt, 02, 4.5, "CanESM2")
proj03_max_hist <- max_hist(proj03_raw.txt, 03, 4.5, "CMCC-CMS")
proj04_max_hist <- max_hist(proj04_raw.txt, 04, 4.5, "CNRM-CM5")
proj05_max_hist <- max_hist(proj05_raw.txt, 05, 4.5, "GFDL-CM3")
proj06_max_hist <- max_hist(proj06_raw.txt, 06, 4.5, "HadGEM2-CC")
proj07_max_hist <- max_hist(proj07_raw.txt, 07, 4.5, "HadGEM2-ES")
proj08_max_hist <- max_hist(proj08_raw.txt, 08, 4.5, "MIROC5")
proj09_max_hist <- max_hist(proj09_raw.txt, 09, 8.5, "ACCESS")
proj10_max_hist <- max_hist(proj10_raw.txt, 10, 8.5, "CanESM2")
proj11_max_hist <- max_hist(proj11_raw.txt, 11, 8.5, "CMCC-CMS")
proj12_max_hist <- max_hist(proj12_raw.txt, 12, 8.5, "CNRM-CM5")
proj13_max_hist <- max_hist(proj13_raw.txt, 13, 8.5, "GFDL-CM3")
proj14_max_hist <- max_hist(proj14_raw.txt, 14, 8.5, "HadGEM2-CC")
proj15_max_hist <- max_hist(proj15_raw.txt, 15, 8.5, "HadGEM2-ES")
proj16_max_hist <- max_hist(proj16_raw.txt, 16, 8.5, "MIROC5")



# Quick data check to make sure the code is pulling the correct max values
proj_test <- proj01_max_hist %>%
  filter(YEAR == 1980) #%>%
#  filter(MONTH == 1) %>% 
#  filter(DAY == 6)


# Combine all separate dfs into one (LONG); coerce all the categorical variables to factors so they can be graphed as separate lines in CDF

max_hist_combined <- rbind(proj01_max_hist, proj02_max_hist, 
                           proj03_max_hist, proj04_max_hist, 
                           proj05_max_hist, proj06_max_hist, 
                           proj07_max_hist, proj08_max_hist, 
                           proj09_max_hist, proj10_max_hist, 
                           proj11_max_hist, proj12_max_hist, 
                           proj13_max_hist, proj14_max_hist, 
                           proj15_max_hist, proj16_max_hist) %>% 
  mutate(proj_year = as.factor(1995)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))




plot_hist <- ggplot(max_hist_combined, aes(HMETTOTmax, colour = PROJ)) + stat_ecdf(geom="step", pad = FALSE) +  # by individual projection
  ggtitle("Historical Climate Projection Data for 16 models: 1985-2000") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/historical.png", dpi = 72) # still super big on github? 

plot_hist_RCP <- ggplot(max_hist_combined, aes(HMETTOTmax, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) + # by RCP (identical, as expected)
  ggtitle("Historical Climate Projection Data for two RCP scenarios: 1985-2000") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs//historical_RCP.png")

plot_hist_GCM <- ggplot(max_hist_combined, aes(HMETTOTmax, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) + #slightly different but largely the same, as expected
  ggtitle("Historical Climate Projection Data for 8 models: 1985-2000") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/historical_GCM.png")


```



# Graph historical baseline distributions


```{r}

hist(proj01_max$HTOTmax)
hist(proj02_max$HTOTmax)
hist(proj03_max$HTOTmax)

# combine into one figure showing probability distribution for each projection?

```


# Repeat for future projections

## 30-year projection centered on 2030

```{r}

max_2030 <- function(x, y, z, m) { 
  proj_max <- x %>% 
  filter(YEAR > 2014) %>% 
  filter(YEAR < 2045) %>% 
  select(YEAR, MONTH, DAY, HMETTOT) %>%
  group_by(YEAR, MONTH, DAY) %>% 
  summarize(HMETTOTmax = max(HMETTOT)) %>% 
  ungroup() %>%
  mutate(PROJ = y) %>%  # add column for distinguishing projection
  mutate(RCP = z) %>% # add column for RCP
  mutate(GCM = m) # add column for GCM

}

# again, replace this with a loop when i figure it out... 
# don't actually need these in separate dfs. Want to write a loop that will combine all of the filtered data into a single df, complete with the projection #s and projection year (end product of this code chunk)
  

proj01_max_2030 <- max_2030(proj01_raw.txt, 01, 4.5, "ACCESS")
proj02_max_2030 <- max_2030(proj02_raw.txt, 02, 4.5, "CanESM2")
proj03_max_2030 <- max_2030(proj03_raw.txt, 03, 4.5, "CMCC-CMS")
proj04_max_2030 <- max_2030(proj04_raw.txt, 04, 4.5, "CNRM-CM5")
proj05_max_2030 <- max_2030(proj05_raw.txt, 05, 4.5, "GFDL-CM3")
proj06_max_2030 <- max_2030(proj06_raw.txt, 06, 4.5, "HadGEM2-CC")
proj07_max_2030 <- max_2030(proj07_raw.txt, 07, 4.5, "HadGEM2-ES")
proj08_max_2030 <- max_2030(proj08_raw.txt, 08, 4.5, "MIROC5")
proj09_max_2030 <- max_2030(proj09_raw.txt, 09, 8.5, "ACCESS")
proj10_max_2030 <- max_2030(proj10_raw.txt, 10, 8.5, "CanESM2")
proj11_max_2030 <- max_2030(proj11_raw.txt, 11, 8.5, "CMCC-CMS")
proj12_max_2030 <- max_2030(proj12_raw.txt, 12, 8.5, "CNRM-CM5")
proj13_max_2030 <- max_2030(proj13_raw.txt, 13, 8.5, "GFDL-CM3")
proj14_max_2030 <- max_2030(proj14_raw.txt, 14, 8.5, "HadGEM2-CC")
proj15_max_2030 <- max_2030(proj15_raw.txt, 15, 8.5, "HadGEM2-ES")
proj16_max_2030 <- max_2030(proj16_raw.txt, 16, 8.5, "MIROC5")


# Combine all models into one data frame
max_2030_combined <- rbind(proj01_max_2030, proj02_max_2030, 
                           proj03_max_2030, proj04_max_2030, 
                           proj05_max_2030, proj06_max_2030, 
                           proj07_max_2030, proj08_max_2030, 
                           proj09_max_2030, proj10_max_2030, 
                           proj11_max_2030, proj12_max_2030, 
                           proj13_max_2030, proj14_max_2030, 
                           proj15_max_2030, proj16_max_2030) %>% 
  mutate(proj_year = as.factor(2030)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))
  




plot_2030 <- ggplot(max_2030_combined, aes(HMETTOTmax, colour = PROJ)) + stat_ecdf(geom="step", pad = FALSE) + # little bit more of a spread across projection models centered around 2030 vs 1995
  ggtitle("Global Climate Projection Data for 16 models: 2015-2045") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2030.png")

plot_2030_RCP <- ggplot(max_2030_combined, aes(HMETTOTmax, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) + # slightly different
  ggtitle("Global Climate Projection Data for two RCP scenarios: 2015-2045") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2030_RCP.png")

plot_2030_GCM <- ggplot(max_2030_combined, aes(HMETTOTmax, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) + # similar to historical
  ggtitle("Global Climate Projection Data for 8 models: 2015-2045") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2030_GCM.png")

```



## 30-year projection centered on 2050

```{r}

max_2050 <- function(x, y, z, m) { 
  proj_max <- x %>% 
  filter(YEAR > 2034) %>% 
  filter(YEAR < 2065) %>% 
  select(YEAR, MONTH, DAY, HMETTOT) %>%
  group_by(YEAR, MONTH, DAY) %>% 
  summarize(HMETTOTmax = max(HMETTOT)) %>% 
  ungroup() %>%
  mutate(PROJ = y) %>%  # add column for distinguishing projection #
  mutate(RCP = z) %>% # add column for RCP
  mutate(GCM = m) # add column for GCM
}

# again, replace this with a loop when i figure it out... 
# don't actually need these in separate dfs. Want to write a loop that will combine all of the filtered data into a single df, complete with the projection #s and projection year (end product of this code chunk)


proj01_max_2050 <- max_2050(proj01_raw.txt, 01, 4.5, "ACCESS")
proj02_max_2050 <- max_2050(proj02_raw.txt, 02, 4.5, "CanESM2")
proj03_max_2050 <- max_2050(proj03_raw.txt, 03, 4.5, "CMCC-CMS")
proj04_max_2050 <- max_2050(proj04_raw.txt, 04, 4.5, "CNRM-CM5")
proj05_max_2050 <- max_2050(proj05_raw.txt, 05, 4.5, "GFDL-CM3")
proj06_max_2050 <- max_2050(proj06_raw.txt, 06, 4.5, "HadGEM2-CC")
proj07_max_2050 <- max_2050(proj07_raw.txt, 07, 4.5, "HadGEM2-ES")
proj08_max_2050 <- max_2050(proj08_raw.txt, 08, 4.5, "MIROC5")
proj09_max_2050 <- max_2050(proj09_raw.txt, 09, 8.5, "ACCESS")
proj10_max_2050 <- max_2050(proj10_raw.txt, 10, 8.5, "CanESM2")
proj11_max_2050 <- max_2050(proj11_raw.txt, 11, 8.5, "CMCC-CMS")
proj12_max_2050 <- max_2050(proj12_raw.txt, 12, 8.5, "CNRM-CM5")
proj13_max_2050 <- max_2050(proj13_raw.txt, 13, 8.5, "GFDL-CM3")
proj14_max_2050 <- max_2050(proj14_raw.txt, 14, 8.5, "HadGEM2-CC")
proj15_max_2050 <- max_2050(proj15_raw.txt, 15, 8.5, "HadGEM2-ES")
proj16_max_2050 <- max_2050(proj16_raw.txt, 16, 8.5, "MIROC5")

max_2050_combined <- rbind(proj01_max_2050, proj02_max_2050, 
                           proj03_max_2050, proj04_max_2050, 
                           proj05_max_2050, proj06_max_2050, 
                           proj07_max_2050, proj08_max_2050, 
                           proj09_max_2050, proj10_max_2050, 
                           proj11_max_2050, proj12_max_2050, 
                           proj13_max_2050, proj14_max_2050, 
                           proj15_max_2050, proj16_max_2050) %>% 
  mutate(proj_year = as.factor(2050)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



plot_2050 <- ggplot(max_2050_combined, aes(HMETTOTmax, colour = PROJ)) + stat_ecdf(geom="step", pad = FALSE) + # spread continues to increase 
  ggtitle("Global Climate Projection Data for 16 models: 2035-2065") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2050.png")

plot_2050_RCP <- ggplot(max_2050_combined, aes(HMETTOTmax, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) + # divergence
  ggtitle("Global Climate Projection Data for two RCP scenarios: 2035-2065") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2050_RCP.png")

plot_2050_GCM <- ggplot(max_2050_combined, aes(HMETTOTmax, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) + # slight divergence
  ggtitle("Global Climate Projection Data for 8 models: 2035-2065") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2050_GCM.png")

```



## 30-year projection centered on 2085

```{r}

max_2085 <- function(x, y, z, m) { 
  proj_max <- x %>% 
  filter(YEAR > 2069) %>% 
  filter(YEAR < 2100) %>% 
  select(YEAR, MONTH, DAY, HMETTOT) %>%
  group_by(YEAR, MONTH, DAY) %>% 
  summarize(HMETTOTmax = max(HMETTOT)) %>% 
  ungroup() %>%
  mutate(PROJ = y) %>%  # add column for distinguishing projection #
  mutate(RCP = z) %>% # add column for RCP
  mutate(GCM = m) # add column for GCM
}



proj01_max_2085 <- max_2085(proj01_raw.txt, 01, 4.5, "ACCESS")
proj02_max_2085 <- max_2085(proj02_raw.txt, 02, 4.5, "CanESM2")
proj03_max_2085 <- max_2085(proj03_raw.txt, 03, 4.5, "CMCC-CMS")
proj04_max_2085 <- max_2085(proj04_raw.txt, 04, 4.5, "CNRM-CM5")
proj05_max_2085 <- max_2085(proj05_raw.txt, 05, 4.5, "GFDL-CM3")
proj06_max_2085 <- max_2085(proj06_raw.txt, 06, 4.5, "HadGEM2-CC")
proj07_max_2085 <- max_2085(proj07_raw.txt, 07, 4.5, "HadGEM2-ES")
proj08_max_2085 <- max_2085(proj08_raw.txt, 08, 4.5, "MIROC5")
proj09_max_2085 <- max_2085(proj09_raw.txt, 09, 8.5, "ACCESS")
proj10_max_2085 <- max_2085(proj10_raw.txt, 10, 8.5, "CanESM2")
proj11_max_2085 <- max_2085(proj11_raw.txt, 11, 8.5, "CMCC-CMS")
proj12_max_2085 <- max_2085(proj12_raw.txt, 12, 8.5, "CNRM-CM5")
proj13_max_2085 <- max_2085(proj13_raw.txt, 13, 8.5, "GFDL-CM3")
proj14_max_2085 <- max_2085(proj14_raw.txt, 14, 8.5, "HadGEM2-CC")
proj15_max_2085 <- max_2085(proj15_raw.txt, 15, 8.5, "HadGEM2-ES")
proj16_max_2085 <- max_2085(proj16_raw.txt, 16, 8.5, "MIROC5")


max_2085_combined <- rbind(proj01_max_2085, proj02_max_2085, 
                           proj03_max_2085, proj04_max_2085, 
                           proj05_max_2085, proj06_max_2085, 
                           proj07_max_2085, proj08_max_2085, 
                           proj09_max_2085, proj10_max_2085, 
                           proj11_max_2085, proj12_max_2085, 
                           proj13_max_2085, proj14_max_2085, 
                           proj15_max_2085, proj16_max_2085) %>% 
  mutate(proj_year = as.factor(2085)) %>%
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))




plot_2085 <- ggplot(max_2085_combined, aes(HMETTOTmax, colour = PROJ)) + stat_ecdf(geom="step", pad = FALSE) + # big gap here between projections for RCP 4.5 vs RCP 8.5
  ggtitle("Global Climate Projection Data for 16 models: 2070-2099") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2085.png")

plot_2085_RCP <- ggplot(max_2085_combined, aes(HMETTOTmax, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) + # large divergence
  ggtitle("Global Climate Projection Data for two RCP scenarios: 2070-2099") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2085_RCP.png")

plot_2085_GCM <- ggplot(max_2085_combined, aes(HMETTOTmax, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) + # slight divergence
  ggtitle("Global Climate Projection Data for 8 models: 2070-2099") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  ggsave("daily max figs/2085_GCM.png")

```


# Visualize historical and future projections together

```{r}

# combine the daily maxima for all projections and add columns to distinguish between models

all_models <- rbind(max_hist_combined, max_2030_combined, max_2050_combined, max_2085_combined)
  

plot_proj_year <- ggplot(all_models, aes(HMETTOTmax, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by Projection Period for All Models - Daily Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("daily max figs/overall.png")


plot_proj_year

qqnorm(all_models$HMETTOTmax, main="(b) Normal Q-Q Plot")


plot_proj_year_GCMfacet <- ggplot(all_models, aes(HMETTOTmax, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  facet_wrap(~GCM) +
  ggtitle("CDF by Projection Period for All Models - Daily Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("daily max figs/overall_GCMfacet.png")


plot_by_RCP <- ggplot(all_models, aes(HMETTOTmax, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by RCP Model - Daily Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("daily max figs/overall_RCP.png")


plot_by_RCP

plot_by_GCM <- ggplot(all_models, aes(HMETTOTmax, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by GCM Model - Daily Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("daily max figs/overall_GCM.png")


plot_by_GCM

```


# Annual maximums 

## Historical
```{r}


max_annual <- function(x) {
  annual_max <- x %>%
    group_by(YEAR, PROJ, RCP, GCM) %>% 
    summarize(annual_max = max(HMETTOTmax)) %>% 
    ungroup()
    
}


proj01_max_hist_annual <- max_annual(proj01_max_hist)
proj02_max_hist_annual <- max_annual(proj02_max_hist)
proj03_max_hist_annual <- max_annual(proj03_max_hist)
proj04_max_hist_annual <- max_annual(proj04_max_hist)
proj05_max_hist_annual <- max_annual(proj05_max_hist)
proj06_max_hist_annual <- max_annual(proj06_max_hist)
proj07_max_hist_annual <- max_annual(proj07_max_hist)
proj08_max_hist_annual <- max_annual(proj08_max_hist)
proj09_max_hist_annual <- max_annual(proj09_max_hist)
proj10_max_hist_annual <- max_annual(proj10_max_hist)
proj11_max_hist_annual <- max_annual(proj11_max_hist)
proj12_max_hist_annual <- max_annual(proj12_max_hist)
proj13_max_hist_annual <- max_annual(proj13_max_hist)
proj14_max_hist_annual <- max_annual(proj14_max_hist)
proj15_max_hist_annual <- max_annual(proj15_max_hist)
proj16_max_hist_annual <- max_annual(proj16_max_hist)


max_hist_combined_annual <- rbind(proj01_max_hist_annual, proj02_max_hist_annual, 
                           proj03_max_hist_annual, proj04_max_hist_annual, 
                           proj05_max_hist_annual, proj06_max_hist_annual, 
                           proj07_max_hist_annual, proj08_max_hist_annual, 
                           proj09_max_hist_annual, proj10_max_hist_annual, 
                           proj11_max_hist_annual, proj12_max_hist_annual, 
                           proj13_max_hist_annual, proj14_max_hist_annual, 
                           proj15_max_hist_annual, proj16_max_hist_annual) %>% 
  mutate(proj_year = as.factor(1995)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



```



## 2030


```{r}

proj01_max_2030_annual <- max_annual(proj01_max_2030)
proj02_max_2030_annual <- max_annual(proj02_max_2030)
proj03_max_2030_annual <- max_annual(proj03_max_2030)
proj04_max_2030_annual <- max_annual(proj04_max_2030)
proj05_max_2030_annual <- max_annual(proj05_max_2030)
proj06_max_2030_annual <- max_annual(proj06_max_2030)
proj07_max_2030_annual <- max_annual(proj07_max_2030)
proj08_max_2030_annual <- max_annual(proj08_max_2030)
proj09_max_2030_annual <- max_annual(proj09_max_2030)
proj10_max_2030_annual <- max_annual(proj10_max_2030)
proj11_max_2030_annual <- max_annual(proj11_max_2030)
proj12_max_2030_annual <- max_annual(proj12_max_2030)
proj13_max_2030_annual <- max_annual(proj13_max_2030)
proj14_max_2030_annual <- max_annual(proj14_max_2030)
proj15_max_2030_annual <- max_annual(proj15_max_2030)
proj16_max_2030_annual <- max_annual(proj16_max_2030)


max_2030_combined_annual <- rbind(proj01_max_2030_annual, proj02_max_2030_annual, 
                           proj03_max_2030_annual, proj04_max_2030_annual, 
                           proj05_max_2030_annual, proj06_max_2030_annual, 
                           proj07_max_2030_annual, proj08_max_2030_annual, 
                           proj09_max_2030_annual, proj10_max_2030_annual, 
                           proj11_max_2030_annual, proj12_max_2030_annual, 
                           proj13_max_2030_annual, proj14_max_2030_annual, 
                           proj15_max_2030_annual, proj16_max_2030_annual) %>% 
  mutate(proj_year = as.factor(2030)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))


  
```



## 2050


```{r}

proj01_max_2050_annual <- max_annual(proj01_max_2050)
proj02_max_2050_annual <- max_annual(proj02_max_2050)
proj03_max_2050_annual <- max_annual(proj03_max_2050)
proj04_max_2050_annual <- max_annual(proj04_max_2050)
proj05_max_2050_annual <- max_annual(proj05_max_2050)
proj06_max_2050_annual <- max_annual(proj06_max_2050)
proj07_max_2050_annual <- max_annual(proj07_max_2050)
proj08_max_2050_annual <- max_annual(proj08_max_2050)
proj09_max_2050_annual <- max_annual(proj09_max_2050)
proj10_max_2050_annual <- max_annual(proj10_max_2050)
proj11_max_2050_annual <- max_annual(proj11_max_2050)
proj12_max_2050_annual <- max_annual(proj12_max_2050)
proj13_max_2050_annual <- max_annual(proj13_max_2050)
proj14_max_2050_annual <- max_annual(proj14_max_2050)
proj15_max_2050_annual <- max_annual(proj15_max_2050)
proj16_max_2050_annual <- max_annual(proj16_max_2050)


max_2050_combined_annual <- rbind(proj01_max_2050_annual, proj02_max_2050_annual, 
                           proj03_max_2050_annual, proj04_max_2050_annual, 
                           proj05_max_2050_annual, proj06_max_2050_annual, 
                           proj07_max_2050_annual, proj08_max_2050_annual, 
                           proj09_max_2050_annual, proj10_max_2050_annual, 
                           proj11_max_2050_annual, proj12_max_2050_annual, 
                           proj13_max_2050_annual, proj14_max_2050_annual, 
                           proj15_max_2050_annual, proj16_max_2050_annual) %>% 
  mutate(proj_year = as.factor(2050)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



```


## 2085


```{r}

proj01_max_2085_annual <- max_annual(proj01_max_2085)
proj02_max_2085_annual <- max_annual(proj02_max_2085)
proj03_max_2085_annual <- max_annual(proj03_max_2085)
proj04_max_2085_annual <- max_annual(proj04_max_2085)
proj05_max_2085_annual <- max_annual(proj05_max_2085)
proj06_max_2085_annual <- max_annual(proj06_max_2085)
proj07_max_2085_annual <- max_annual(proj07_max_2085)
proj08_max_2085_annual <- max_annual(proj08_max_2085)
proj09_max_2085_annual <- max_annual(proj09_max_2085)
proj10_max_2085_annual <- max_annual(proj10_max_2085)
proj11_max_2085_annual <- max_annual(proj11_max_2085)
proj12_max_2085_annual <- max_annual(proj12_max_2085)
proj13_max_2085_annual <- max_annual(proj13_max_2085)
proj14_max_2085_annual <- max_annual(proj14_max_2085)
proj15_max_2085_annual <- max_annual(proj15_max_2085)
proj16_max_2085_annual <- max_annual(proj16_max_2085)


max_2085_combined_annual <- rbind(proj01_max_2085_annual, proj02_max_2085_annual, 
                           proj03_max_2085_annual, proj04_max_2085_annual, 
                           proj05_max_2085_annual, proj06_max_2085_annual, 
                           proj07_max_2085_annual, proj08_max_2085_annual, 
                           proj09_max_2085_annual, proj10_max_2085_annual, 
                           proj11_max_2085_annual, proj12_max_2085_annual, 
                           proj13_max_2085_annual, proj14_max_2085_annual, 
                           proj15_max_2085_annual, proj16_max_2085_annual) %>% 
  mutate(proj_year = as.factor(2085)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



```


## Figures

```{r}

all_annual_models <- rbind(max_hist_combined_annual, max_2030_combined_annual, max_2050_combined_annual, max_2085_combined_annual)

plot_proj_year_annual <- ggplot(all_annual_models, aes(annual_max, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by Projection Period for All Models - Annual Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("annual max figs/overall_annual.png")


plot_proj_year_annual

plot_proj_year_GCMfacet <- ggplot(all_annual_models, aes(annual_max, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  facet_wrap(~GCM) +
  ggtitle("CDF by Projection Period for All Models - Annual Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("annual max figs/overall_annual_GCMfacet.png")


plot_by_RCP <- ggplot(all_annual_models, aes(annual_max, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by RCP Model - Annual Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("annual max figs/overall_annual_RCP.png")


plot_by_RCP

plot_by_GCM <- ggplot(all_annual_models, aes(annual_max, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by GCM Model - Annual Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("annual max figs/overall_annual_GCM.png")

```



# Monthly maximums

## Historical
```{r}


max_monthly <- function(x) {
  annual_max <- x %>%
    group_by(YEAR, MONTH, PROJ, RCP, GCM) %>% 
    summarize(monthly_max = max(HMETTOTmax)) %>% 
    ungroup()
    
}


proj01_max_hist_monthly <- max_monthly(proj01_max_hist)
proj02_max_hist_monthly <- max_monthly(proj02_max_hist)
proj03_max_hist_monthly <- max_monthly(proj03_max_hist)
proj04_max_hist_monthly <- max_monthly(proj04_max_hist)
proj05_max_hist_monthly <- max_monthly(proj05_max_hist)
proj06_max_hist_monthly <- max_monthly(proj06_max_hist)
proj07_max_hist_monthly <- max_monthly(proj07_max_hist)
proj08_max_hist_monthly <- max_monthly(proj08_max_hist)
proj09_max_hist_monthly <- max_monthly(proj09_max_hist)
proj10_max_hist_monthly <- max_monthly(proj10_max_hist)
proj11_max_hist_monthly <- max_monthly(proj11_max_hist)
proj12_max_hist_monthly <- max_monthly(proj12_max_hist)
proj13_max_hist_monthly <- max_monthly(proj13_max_hist)
proj14_max_hist_monthly <- max_monthly(proj14_max_hist)
proj15_max_hist_monthly <- max_monthly(proj15_max_hist)
proj16_max_hist_monthly <- max_monthly(proj16_max_hist)


max_hist_combined_monthly <- rbind(proj01_max_hist_monthly, proj02_max_hist_monthly, 
                           proj03_max_hist_monthly, proj04_max_hist_monthly, 
                           proj05_max_hist_monthly, proj06_max_hist_monthly, 
                           proj07_max_hist_monthly, proj08_max_hist_monthly, 
                           proj09_max_hist_monthly, proj10_max_hist_monthly, 
                           proj11_max_hist_monthly, proj12_max_hist_monthly, 
                           proj13_max_hist_monthly, proj14_max_hist_monthly, 
                           proj15_max_hist_monthly, proj16_max_hist_monthly) %>% 
  mutate(proj_year = as.factor(1995)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



#proj_test <- proj01_max_hist %>%
#  filter(YEAR == 1995) %>%
#  filter(MONTH == 4) #%>% 

```



## 2030


```{r}

proj01_max_2030_monthly <- max_monthly(proj01_max_2030)
proj02_max_2030_monthly <- max_monthly(proj02_max_2030)
proj03_max_2030_monthly <- max_monthly(proj03_max_2030)
proj04_max_2030_monthly <- max_monthly(proj04_max_2030)
proj05_max_2030_monthly <- max_monthly(proj05_max_2030)
proj06_max_2030_monthly <- max_monthly(proj06_max_2030)
proj07_max_2030_monthly <- max_monthly(proj07_max_2030)
proj08_max_2030_monthly <- max_monthly(proj08_max_2030)
proj09_max_2030_monthly <- max_monthly(proj09_max_2030)
proj10_max_2030_monthly <- max_monthly(proj10_max_2030)
proj11_max_2030_monthly <- max_monthly(proj11_max_2030)
proj12_max_2030_monthly <- max_monthly(proj12_max_2030)
proj13_max_2030_monthly <- max_monthly(proj13_max_2030)
proj14_max_2030_monthly <- max_monthly(proj14_max_2030)
proj15_max_2030_monthly <- max_monthly(proj15_max_2030)
proj16_max_2030_monthly <- max_monthly(proj16_max_2030)


max_2030_combined_monthly <- rbind(proj01_max_2030_monthly, proj02_max_2030_monthly, 
                           proj03_max_2030_monthly, proj04_max_2030_monthly, 
                           proj05_max_2030_monthly, proj06_max_2030_monthly, 
                           proj07_max_2030_monthly, proj08_max_2030_monthly, 
                           proj09_max_2030_monthly, proj10_max_2030_monthly, 
                           proj11_max_2030_monthly, proj12_max_2030_monthly, 
                           proj13_max_2030_monthly, proj14_max_2030_monthly, 
                           proj15_max_2030_monthly, proj16_max_2030_monthly) %>% 
  mutate(proj_year = as.factor(2030)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))


  
```



## 2050


```{r}

proj01_max_2050_monthly <- max_monthly(proj01_max_2050)
proj02_max_2050_monthly <- max_monthly(proj02_max_2050)
proj03_max_2050_monthly <- max_monthly(proj03_max_2050)
proj04_max_2050_monthly <- max_monthly(proj04_max_2050)
proj05_max_2050_monthly <- max_monthly(proj05_max_2050)
proj06_max_2050_monthly <- max_monthly(proj06_max_2050)
proj07_max_2050_monthly <- max_monthly(proj07_max_2050)
proj08_max_2050_monthly <- max_monthly(proj08_max_2050)
proj09_max_2050_monthly <- max_monthly(proj09_max_2050)
proj10_max_2050_monthly <- max_monthly(proj10_max_2050)
proj11_max_2050_monthly <- max_monthly(proj11_max_2050)
proj12_max_2050_monthly <- max_monthly(proj12_max_2050)
proj13_max_2050_monthly <- max_monthly(proj13_max_2050)
proj14_max_2050_monthly <- max_monthly(proj14_max_2050)
proj15_max_2050_monthly <- max_monthly(proj15_max_2050)
proj16_max_2050_monthly <- max_monthly(proj16_max_2050)


max_2050_combined_monthly <- rbind(proj01_max_2050_monthly, proj02_max_2050_monthly, 
                           proj03_max_2050_monthly, proj04_max_2050_monthly, 
                           proj05_max_2050_monthly, proj06_max_2050_monthly, 
                           proj07_max_2050_monthly, proj08_max_2050_monthly, 
                           proj09_max_2050_monthly, proj10_max_2050_monthly, 
                           proj11_max_2050_monthly, proj12_max_2050_monthly, 
                           proj13_max_2050_monthly, proj14_max_2050_monthly, 
                           proj15_max_2050_monthly, proj16_max_2050_monthly) %>% 
  mutate(proj_year = as.factor(2050)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



```


## 2085


```{r}

proj01_max_2085_monthly <- max_monthly(proj01_max_2085)
proj02_max_2085_monthly <- max_monthly(proj02_max_2085)
proj03_max_2085_monthly <- max_monthly(proj03_max_2085)
proj04_max_2085_monthly <- max_monthly(proj04_max_2085)
proj05_max_2085_monthly <- max_monthly(proj05_max_2085)
proj06_max_2085_monthly <- max_monthly(proj06_max_2085)
proj07_max_2085_monthly <- max_monthly(proj07_max_2085)
proj08_max_2085_monthly <- max_monthly(proj08_max_2085)
proj09_max_2085_monthly <- max_monthly(proj09_max_2085)
proj10_max_2085_monthly <- max_monthly(proj10_max_2085)
proj11_max_2085_monthly <- max_monthly(proj11_max_2085)
proj12_max_2085_monthly <- max_monthly(proj12_max_2085)
proj13_max_2085_monthly <- max_monthly(proj13_max_2085)
proj14_max_2085_monthly <- max_monthly(proj14_max_2085)
proj15_max_2085_monthly <- max_monthly(proj15_max_2085)
proj16_max_2085_monthly <- max_monthly(proj16_max_2085)


max_2085_combined_monthly <- rbind(proj01_max_2085_monthly, proj02_max_2085_monthly, 
                           proj03_max_2085_monthly, proj04_max_2085_monthly, 
                           proj05_max_2085_monthly, proj06_max_2085_monthly, 
                           proj07_max_2085_monthly, proj08_max_2085_monthly, 
                           proj09_max_2085_monthly, proj10_max_2085_monthly, 
                           proj11_max_2085_monthly, proj12_max_2085_monthly, 
                           proj13_max_2085_monthly, proj14_max_2085_monthly, 
                           proj15_max_2085_monthly, proj16_max_2085_monthly) %>% 
  mutate(proj_year = as.factor(2085)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



```


## Figures

```{r}

all_monthly_models <- rbind(max_hist_combined_monthly, max_2030_combined_monthly, max_2050_combined_monthly, max_2085_combined_monthly)

plot_proj_year_monthly <- ggplot(all_monthly_models, aes(monthly_max, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by Projection Period for All Models - Monthly Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("monthly max figs/overall_monthly.png")


plot_proj_year_monthly

plot_proj_year_monthly_GCMfacet <- ggplot(all_monthly_models, aes(monthly_max, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  facet_wrap(~GCM) +
  ggtitle("CDF by Projection Period for All Models - Monthly Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("monthly max figs/overall_monthly_GCMfacet.png")


plot_by_RCP <- ggplot(all_monthly_models, aes(monthly_max, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by RCP Model - Monthly Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("monthly max figs/overall_monthly_RCP.png")


plot_by_RCP

plot_by_GCM <- ggplot(all_monthly_models, aes(monthly_max, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by GCM Model - Monthly Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("monthly max figs/overall_monthly_GCM.png")

```



# Seasonal maximums


*Meteorologically-defined seasons:*
- Spring: March 1 - May 31
- Summer: June 1 - August 31
- Fall: Sep 1 - Nov 30
- Winter: Dec 1 - Feb 28

max_seasonal function parameters:
- x = raw data set
- a = lower bound year
- b = upper bound year
- y = projection year
- z = RCP
- m = model name

## Historical
```{r}


max_seasonal <- function(x, a, b, p, r, m) {
  annual_max <- x %>% 
  filter(YEAR > a) %>% 
  filter(YEAR < b) %>%
  select(YEAR, MONTH, HMETTOT) %>%
  mutate(PROJ = p) %>% 
  mutate(RCP = r) %>% 
  mutate(GCM = m) %>% 
  mutate(YEAR = ifelse(MONTH == 12, YEAR+1, YEAR)) %>% # coerce December into following year
  filter(YEAR != max(YEAR)) %>%  # filter out maximum year; don't want to include it
  filter(YEAR > a+1) %>% 
  mutate(SEASON = ifelse(MONTH == 12 | MONTH == 1 | MONTH == 2, "Winter",
                         ifelse(MONTH == 3 | MONTH == 4 | MONTH == 5, "Spring",
                                ifelse(MONTH == 6 | MONTH == 7 | MONTH == 8, "Summer",
                                       ifelse(MONTH == 9 | MONTH == 10 | MONTH == 11, "Fall",
                                              NA))))) %>% # assign season names to seasonal date ranges
  group_by(YEAR, PROJ, RCP, GCM, SEASON) %>% 
  summarize(seasonal_max = max(HMETTOT)) %>% 
  ungroup()
    
}



proj01_max_hist_seasonal <- max_seasonal(proj01_raw.txt, 1978, 2010, 01, 4.5, "ACCESS")
proj02_max_hist_seasonal <- max_seasonal(proj02_raw.txt, 1978, 2010, 02, 4.5, "CanESM2")
proj03_max_hist_seasonal <- max_seasonal(proj03_raw.txt, 1978, 2010, 03, 4.5, "CMCC-CMS")
proj04_max_hist_seasonal <- max_seasonal(proj04_raw.txt, 1978, 2010, 04, 4.5, "CNRM-CM5")
proj05_max_hist_seasonal <- max_seasonal(proj05_raw.txt, 1978, 2010, 05, 4.5, "GFDL-CM3")
proj06_max_hist_seasonal <- max_seasonal(proj06_raw.txt, 1978, 2010, 06, 4.5, "HadGEM2-CC")
proj07_max_hist_seasonal <- max_seasonal(proj07_raw.txt, 1978, 2010, 07, 4.5, "HadGEM2-ES")
proj08_max_hist_seasonal <- max_seasonal(proj08_raw.txt, 1978, 2010, 08, 4.5, "MIROC5")
proj09_max_hist_seasonal <- max_seasonal(proj09_raw.txt, 1978, 2010, 09, 8.5, "ACCESS")
proj10_max_hist_seasonal <- max_seasonal(proj10_raw.txt, 1978, 2010, 10, 8.5, "CanESM2")
proj11_max_hist_seasonal <- max_seasonal(proj11_raw.txt, 1978, 2010, 11, 8.5, "CMCC-CMS")
proj12_max_hist_seasonal <- max_seasonal(proj12_raw.txt, 1978, 2010, 12, 8.5, "CNRM-CM5")
proj13_max_hist_seasonal <- max_seasonal(proj13_raw.txt, 1978, 2010, 13, 8.5, "GFDL-CM3")
proj14_max_hist_seasonal <- max_seasonal(proj14_raw.txt, 1978, 2010, 14, 8.5, "HadGEM2-CC")
proj15_max_hist_seasonal <- max_seasonal(proj15_raw.txt, 1978, 2010, 15, 8.5, "HadGEM2-ES")
proj16_max_hist_seasonal <- max_seasonal(proj16_raw.txt, 1978, 2010, 16, 8.5, "MIROC5")



max_hist_combined_seasonal <- rbind(proj01_max_hist_seasonal, proj02_max_hist_seasonal, 
                           proj03_max_hist_seasonal, proj04_max_hist_seasonal, 
                           proj05_max_hist_seasonal, proj06_max_hist_seasonal, 
                           proj07_max_hist_seasonal, proj08_max_hist_seasonal, 
                           proj09_max_hist_seasonal, proj10_max_hist_seasonal, 
                           proj11_max_hist_seasonal, proj12_max_hist_seasonal, 
                           proj13_max_hist_seasonal, proj14_max_hist_seasonal, 
                           proj15_max_hist_seasonal, proj16_max_hist_seasonal) %>% 
  mutate(proj_year = as.factor(1995)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



#proj_test <- proj01_max_hist %>%
#  filter(YEAR == 1990 | MONTH == 12) %>% 
#  filter(YEAR == 1989 | MONTH == 1 | MONTH == 2) 

```


## 2030
```{r}

 
proj01_max_2030_seasonal <- max_seasonal(proj01_raw.txt, 2013, 2045, 01, 4.5, "ACCESS")
proj02_max_2030_seasonal <- max_seasonal(proj02_raw.txt, 2013, 2045, 02, 4.5, "CanESM2")
proj03_max_2030_seasonal <- max_seasonal(proj03_raw.txt, 2013, 2045, 03, 4.5, "CMCC-CMS")
proj04_max_2030_seasonal <- max_seasonal(proj04_raw.txt, 2013, 2045, 04, 4.5, "CNRM-CM5")
proj05_max_2030_seasonal <- max_seasonal(proj05_raw.txt, 2013, 2045, 05, 4.5, "GFDL-CM3")
proj06_max_2030_seasonal <- max_seasonal(proj06_raw.txt, 2013, 2045, 06, 4.5, "HadGEM2-CC")
proj07_max_2030_seasonal <- max_seasonal(proj07_raw.txt, 2013, 2045, 07, 4.5, "HadGEM2-ES")
proj08_max_2030_seasonal <- max_seasonal(proj08_raw.txt, 2013, 2045, 08, 4.5, "MIROC5")
proj09_max_2030_seasonal <- max_seasonal(proj09_raw.txt, 2013, 2045, 09, 8.5, "ACCESS")
proj10_max_2030_seasonal <- max_seasonal(proj10_raw.txt, 2013, 2045, 10, 8.5, "CanESM2")
proj11_max_2030_seasonal <- max_seasonal(proj11_raw.txt, 2013, 2045, 11, 8.5, "CMCC-CMS")
proj12_max_2030_seasonal <- max_seasonal(proj12_raw.txt, 2013, 2045, 12, 8.5, "CNRM-CM5")
proj13_max_2030_seasonal <- max_seasonal(proj13_raw.txt, 2013, 2045, 13, 8.5, "GFDL-CM3")
proj14_max_2030_seasonal <- max_seasonal(proj14_raw.txt, 2013, 2045, 14, 8.5, "HadGEM2-CC")
proj15_max_2030_seasonal <- max_seasonal(proj15_raw.txt, 2013, 2045, 15, 8.5, "HadGEM2-ES")
proj16_max_2030_seasonal <- max_seasonal(proj16_raw.txt, 2013, 2045, 16, 8.5, "MIROC5")



max_2030_combined_seasonal <- rbind(proj01_max_2030_seasonal, proj02_max_2030_seasonal, 
                           proj03_max_2030_seasonal, proj04_max_2030_seasonal, 
                           proj05_max_2030_seasonal, proj06_max_2030_seasonal, 
                           proj07_max_2030_seasonal, proj08_max_2030_seasonal, 
                           proj09_max_2030_seasonal, proj10_max_2030_seasonal, 
                           proj11_max_2030_seasonal, proj12_max_2030_seasonal, 
                           proj13_max_2030_seasonal, proj14_max_2030_seasonal, 
                           proj15_max_2030_seasonal, proj16_max_2030_seasonal) %>% 
  mutate(proj_year = as.factor(2030)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



#proj_test <- proj01_max_hist %>%
#  filter(YEAR == 1990 | MONTH == 12) %>% 
#  filter(YEAR == 1989 | MONTH == 1 | MONTH == 2) 

```


## 2050
```{r}

 
proj01_max_2050_seasonal <- max_seasonal(proj01_raw.txt, 2033, 2065, 01, 4.5, "ACCESS")
proj02_max_2050_seasonal <- max_seasonal(proj02_raw.txt, 2033, 2065, 02, 4.5, "CanESM2")
proj03_max_2050_seasonal <- max_seasonal(proj03_raw.txt, 2033, 2065, 03, 4.5, "CMCC-CMS")
proj04_max_2050_seasonal <- max_seasonal(proj04_raw.txt, 2033, 2065, 04, 4.5, "CNRM-CM5")
proj05_max_2050_seasonal <- max_seasonal(proj05_raw.txt, 2033, 2065, 05, 4.5, "GFDL-CM3")
proj06_max_2050_seasonal <- max_seasonal(proj06_raw.txt, 2033, 2065, 06, 4.5, "HadGEM2-CC")
proj07_max_2050_seasonal <- max_seasonal(proj07_raw.txt, 2033, 2065, 07, 4.5, "HadGEM2-ES")
proj08_max_2050_seasonal <- max_seasonal(proj08_raw.txt, 2033, 2065, 08, 4.5, "MIROC5")
proj09_max_2050_seasonal <- max_seasonal(proj09_raw.txt, 2033, 2065, 09, 8.5, "ACCESS")
proj10_max_2050_seasonal <- max_seasonal(proj10_raw.txt, 2033, 2065, 10, 8.5, "CanESM2")
proj11_max_2050_seasonal <- max_seasonal(proj11_raw.txt, 2033, 2065, 11, 8.5, "CMCC-CMS")
proj12_max_2050_seasonal <- max_seasonal(proj12_raw.txt, 2033, 2065, 12, 8.5, "CNRM-CM5")
proj13_max_2050_seasonal <- max_seasonal(proj13_raw.txt, 2033, 2065, 13, 8.5, "GFDL-CM3")
proj14_max_2050_seasonal <- max_seasonal(proj14_raw.txt, 2033, 2065, 14, 8.5, "HadGEM2-CC")
proj15_max_2050_seasonal <- max_seasonal(proj15_raw.txt, 2033, 2065, 15, 8.5, "HadGEM2-ES")
proj16_max_2050_seasonal <- max_seasonal(proj16_raw.txt, 2033, 2065, 16, 8.5, "MIROC5")



max_2050_combined_seasonal <- rbind(proj01_max_2050_seasonal, proj02_max_2050_seasonal, 
                           proj03_max_2050_seasonal, proj04_max_2050_seasonal, 
                           proj05_max_2050_seasonal, proj06_max_2050_seasonal, 
                           proj07_max_2050_seasonal, proj08_max_2050_seasonal, 
                           proj09_max_2050_seasonal, proj10_max_2050_seasonal, 
                           proj11_max_2050_seasonal, proj12_max_2050_seasonal, 
                           proj13_max_2050_seasonal, proj14_max_2050_seasonal, 
                           proj15_max_2050_seasonal, proj16_max_2050_seasonal) %>% 
  mutate(proj_year = as.factor(2050)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))



#proj_test <- proj01_max_hist %>%
#  filter(YEAR == 1990 | MONTH == 12) %>% 
#  filter(YEAR == 1989 | MONTH == 1 | MONTH == 2) 

```




## 2085
```{r}

 
proj01_max_2085_seasonal <- max_seasonal(proj01_raw.txt, 2068, 2100, 01, 4.5, "ACCESS")
proj02_max_2085_seasonal <- max_seasonal(proj02_raw.txt, 2068, 2100, 02, 4.5, "CanESM2")
proj03_max_2085_seasonal <- max_seasonal(proj03_raw.txt, 2068, 2100, 03, 4.5, "CMCC-CMS")
proj04_max_2085_seasonal <- max_seasonal(proj04_raw.txt, 2068, 2100, 04, 4.5, "CNRM-CM5")
proj05_max_2085_seasonal <- max_seasonal(proj05_raw.txt, 2068, 2100, 05, 4.5, "GFDL-CM3")
proj06_max_2085_seasonal <- max_seasonal(proj06_raw.txt, 2068, 2100, 06, 4.5, "HadGEM2-CC")
proj07_max_2085_seasonal <- max_seasonal(proj07_raw.txt, 2068, 2100, 07, 4.5, "HadGEM2-ES")
proj08_max_2085_seasonal <- max_seasonal(proj08_raw.txt, 2068, 2100, 08, 4.5, "MIROC5")
proj09_max_2085_seasonal <- max_seasonal(proj09_raw.txt, 2068, 2100, 09, 8.5, "ACCESS")
proj10_max_2085_seasonal <- max_seasonal(proj10_raw.txt, 2068, 2100, 10, 8.5, "CanESM2")
proj11_max_2085_seasonal <- max_seasonal(proj11_raw.txt, 2068, 2100, 11, 8.5, "CMCC-CMS")
proj12_max_2085_seasonal <- max_seasonal(proj12_raw.txt, 2068, 2100, 12, 8.5, "CNRM-CM5")
proj13_max_2085_seasonal <- max_seasonal(proj13_raw.txt, 2068, 2100, 13, 8.5, "GFDL-CM3")
proj14_max_2085_seasonal <- max_seasonal(proj14_raw.txt, 2068, 2100, 14, 8.5, "HadGEM2-CC")
proj15_max_2085_seasonal <- max_seasonal(proj15_raw.txt, 2068, 2100, 15, 8.5, "HadGEM2-ES")
proj16_max_2085_seasonal <- max_seasonal(proj16_raw.txt, 2068, 2100, 16, 8.5, "MIROC5")



max_2085_combined_seasonal <- rbind(proj01_max_2085_seasonal, proj02_max_2085_seasonal, 
                           proj03_max_2085_seasonal, proj04_max_2085_seasonal, 
                           proj05_max_2085_seasonal, proj06_max_2085_seasonal, 
                           proj07_max_2085_seasonal, proj08_max_2085_seasonal, 
                           proj09_max_2085_seasonal, proj10_max_2085_seasonal, 
                           proj11_max_2085_seasonal, proj12_max_2085_seasonal, 
                           proj13_max_2085_seasonal, proj14_max_2085_seasonal, 
                           proj15_max_2085_seasonal, proj16_max_2085_seasonal) %>% 
  mutate(proj_year = as.factor(2085)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))

 

#proj_test <- proj01_max_hist %>%
#  filter(YEAR == 1990 | MONTH == 12) %>% 
#  filter(YEAR == 1989 | MONTH == 1 | MONTH == 2) 

```


## Seasonal Figures

```{r}

all_seasonal_models <- rbind(max_hist_combined_seasonal, max_2030_combined_seasonal, max_2050_combined_seasonal, max_2085_combined_seasonal)

plot_proj_year_seasonal <- ggplot(all_seasonal_models, aes(seasonal_max, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by Projection Period for All Models - Seasonal Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("seasonal max figs/overall_seasonal.png")


plot_proj_year_seasonal

plot_proj_year_seasonal_GCMfacet <- ggplot(all_seasonal_models, aes(seasonal_max, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  facet_wrap(~GCM) +
  ggtitle("CDF by Projection Period for All Models - Seasonal Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("seasonal max figs/overall_seasonal_GCMfacet.png")

plot_proj_year_seasonal_facet <- ggplot(all_seasonal_models, aes(seasonal_max, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  facet_wrap(~SEASON) +
  ggtitle("CDF by Projection Period for All Models - Seasonal Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("seasonal max figs/overall_seasonal_facet.png")


plot_by_RCP <- ggplot(all_seasonal_models, aes(seasonal_max, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by RCP Model - Seasonal Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("seasonal max figs/overall_seasonal_RCP.png")


plot_by_RCP

plot_by_GCM <- ggplot(all_seasonal_models, aes(seasonal_max, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by GCM Model - Seasonal Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("seasonal max figs/overall_seasonal_GCM.png")

```



# Linear regression and significance testing

## Annual *maxmima* for each model/scenario

```{r}

max_annual_overall <- function(x, z) { # Inputs/parameters: x = df name, z = proj ID
  proj_max <- x %>% 
  filter(YEAR > 1999) %>% 
  select(YEAR, HMETTOT) %>%
  group_by(YEAR) %>% 
  summarize(max = max(HMETTOT)) %>% 
  ungroup()

}


proj01_max <- max_annual_overall(proj01_raw.txt) %>% 
  rename("01" = max)
proj02_max <- max_annual_overall(proj02_raw.txt) %>% 
  rename("02" = max)
proj03_max <- max_annual_overall(proj03_raw.txt) %>% 
  rename("03" = max)
proj04_max <- max_annual_overall(proj04_raw.txt) %>% 
  rename("04" = max)
proj05_max <- max_annual_overall(proj05_raw.txt) %>% 
  rename("05" = max)
proj06_max <- max_annual_overall(proj06_raw.txt) %>% 
  rename("06" = max)
proj07_max <- max_annual_overall(proj07_raw.txt) %>% 
  rename("07" = max)
proj08_max <- max_annual_overall(proj08_raw.txt) %>% 
  rename("08" = max)
proj09_max <- max_annual_overall(proj09_raw.txt) %>% 
  rename("09" = max)
proj10_max <- max_annual_overall(proj10_raw.txt) %>% 
  rename("10" = max)
proj11_max <- max_annual_overall(proj11_raw.txt) %>% 
  rename("11" = max)
proj12_max <- max_annual_overall(proj12_raw.txt) %>% 
  rename("12" = max)
proj13_max <- max_annual_overall(proj13_raw.txt) %>% 
  rename("13" = max)
proj14_max <- max_annual_overall(proj14_raw.txt) %>% 
  rename("14" = max)
proj15_max <- max_annual_overall(proj15_raw.txt) %>% 
  rename("15" = max)
proj16_max <- max_annual_overall(proj16_raw.txt) %>% 
  rename("16" = max)




# Combine all separate dfs into one, with each column representing max HMETTOT by year for each model (WIDE)

max_annual_combined <- left_join(proj01_max, proj02_max, by = "YEAR") %>% 
  left_join(proj03_max, by="YEAR") %>% 
  left_join(proj04_max, by="YEAR") %>% 
  left_join(proj05_max, by="YEAR") %>% 
  left_join(proj06_max, by="YEAR") %>% 
  left_join(proj07_max, by="YEAR") %>% 
  left_join(proj08_max, by="YEAR") %>% 
  left_join(proj09_max, by="YEAR") %>% 
  left_join(proj10_max, by="YEAR") %>% 
  left_join(proj11_max, by="YEAR") %>% 
  left_join(proj12_max, by="YEAR") %>% 
  left_join(proj13_max, by="YEAR") %>% 
  left_join(proj14_max, by="YEAR") %>% 
  left_join(proj15_max, by="YEAR") %>% 
  left_join(proj16_max, by="YEAR")


```


### Linear regression and significance for annual maxima

```{r}

lapply(max_annual_combined[-1], function(x) summary(lm(x ~ max_annual_combined$YEAR)))


lapply(max_annual_combined[-1], function(x) cor.test(x, max_annual_combined$YEAR, method="kendall"))


```



## Annual *means* for each model/scenario


```{r}


mean_annual_overall <- function(x, z) { # Inputs/parameters: x = df name
  proj_max <- x %>% 
  filter(YEAR > 1999) %>% 
  select(YEAR, HMETTOT) %>%
  group_by(YEAR) %>% 
  summarize(mean = mean(HMETTOT)) %>% 
  ungroup()

}

proj01_mean <- mean_annual_overall(proj01_raw.txt) %>% 
  rename("01" = mean)
proj02_mean <- mean_annual_overall(proj02_raw.txt) %>% 
  rename("02" = mean)
proj03_mean <- mean_annual_overall(proj03_raw.txt) %>% 
  rename("03" = mean)
proj04_mean <- mean_annual_overall(proj04_raw.txt) %>% 
  rename("04" = mean)
proj05_mean <- mean_annual_overall(proj05_raw.txt) %>% 
  rename("05" = mean)
proj06_mean <- mean_annual_overall(proj06_raw.txt) %>% 
  rename("06" = mean)
proj07_mean <- mean_annual_overall(proj07_raw.txt) %>% 
  rename("07" = mean)
proj08_mean <- mean_annual_overall(proj08_raw.txt) %>% 
  rename("08" = mean)
proj09_mean <- mean_annual_overall(proj09_raw.txt) %>% 
  rename("09" = mean)
proj10_mean <- mean_annual_overall(proj10_raw.txt) %>% 
  rename("10" = mean)
proj11_mean <- mean_annual_overall(proj11_raw.txt) %>% 
  rename("11" = mean)
proj12_mean <- mean_annual_overall(proj12_raw.txt) %>% 
  rename("12" = mean)
proj13_mean <- mean_annual_overall(proj13_raw.txt) %>% 
  rename("13" = mean)
proj14_mean <- mean_annual_overall(proj14_raw.txt) %>% 
  rename("14" = mean)
proj15_mean <- mean_annual_overall(proj15_raw.txt) %>% 
  rename("15" = mean)
proj16_mean <- mean_annual_overall(proj16_raw.txt) %>% 
  rename("16" = mean)



# Combine all separate dfs into one, with each column representing mean HMETTOT by year for each model (WIDE)

mean_annual_combined <- left_join(proj01_mean, proj02_mean, by = "YEAR") %>%
  left_join(proj03_mean, by="YEAR") %>% 
  left_join(proj04_mean, by="YEAR") %>% 
  left_join(proj05_mean, by="YEAR") %>% 
  left_join(proj06_mean, by="YEAR") %>% 
  left_join(proj07_mean, by="YEAR") %>% 
  left_join(proj08_mean, by="YEAR") %>% 
  left_join(proj09_mean, by="YEAR") %>% 
  left_join(proj10_mean, by="YEAR") %>% 
  left_join(proj11_mean, by="YEAR") %>% 
  left_join(proj12_mean, by="YEAR") %>% 
  left_join(proj13_mean, by="YEAR") %>% 
  left_join(proj14_mean, by="YEAR") %>% 
  left_join(proj15_mean, by="YEAR") %>% 
  left_join(proj16_mean, by="YEAR")



```

## Linear regression and significance testing for annual means

```{r}

lapply(mean_annual_combined[-1], function(x) summary(lm(x ~ mean_annual_combined$YEAR)))

lapply(mean_annual_combined[-1], function(x) cor.test(x, mean_annual_combined$YEAR, method="kendall"))


```



# Monthly analysis of HMETTOT+HAST 


```{r}

max_monthly_hast_hmettot <- function(x, y, z, m) { # Inputs/parameters: x = df name, y = proj #, z = RCP, m = model
  proj_max <- x %>% 
  select(YEAR, MONTH, HAST, HMETTOT) %>%
  mutate(HAST_HMETTOT = HAST+HMETTOT) %>% 
  group_by(YEAR, MONTH) %>% 
  summarise(HAST_HMETTOTmax = max(HAST_HMETTOT)) %>% 
  ungroup() %>%
  mutate(PROJ = y) %>%  # add column for distinguishing projection
  mutate(RCP = z) %>% # add column for RCP
  mutate(GCM = m) # add column for GCM

}


proj01_hast_hmettot <- max_monthly_hast_hmettot(proj01_raw.txt, 01, 4.5, "ACCESS")
proj02_hast_hmettot <- max_monthly_hast_hmettot(proj02_raw.txt, 02, 4.5, "CanESM2")
proj03_hast_hmettot <- max_monthly_hast_hmettot(proj03_raw.txt, 03, 4.5, "CMCC-CMS")
proj04_hast_hmettot <- max_monthly_hast_hmettot(proj04_raw.txt, 04, 4.5, "CNRM-CM5")
proj05_hast_hmettot <- max_monthly_hast_hmettot(proj05_raw.txt, 05, 4.5, "GFDL-CM3")
proj06_hast_hmettot <- max_monthly_hast_hmettot(proj06_raw.txt, 06, 4.5, "HadGEM2-CC")
proj07_hast_hmettot <- max_monthly_hast_hmettot(proj07_raw.txt, 07, 4.5, "HadGEM2-ES")
proj08_hast_hmettot <- max_monthly_hast_hmettot(proj08_raw.txt, 08, 4.5, "MIROC5")
proj09_hast_hmettot <- max_monthly_hast_hmettot(proj09_raw.txt, 09, 8.5, "ACCESS")
proj10_hast_hmettot <- max_monthly_hast_hmettot(proj10_raw.txt, 10, 8.5, "CanESM2")
proj11_hast_hmettot <- max_monthly_hast_hmettot(proj11_raw.txt, 11, 8.5, "CMCC-CMS")
proj12_hast_hmettot <- max_monthly_hast_hmettot(proj12_raw.txt, 12, 8.5, "CNRM-CM5")
proj13_hast_hmettot <- max_monthly_hast_hmettot(proj13_raw.txt, 13, 8.5, "GFDL-CM3")
proj14_hast_hmettot <- max_monthly_hast_hmettot(proj14_raw.txt, 14, 8.5, "HadGEM2-CC")
proj15_hast_hmettot <- max_monthly_hast_hmettot(proj15_raw.txt, 15, 8.5, "HadGEM2-ES")
proj16_hast_hmettot <- max_monthly_hast_hmettot(proj16_raw.txt, 16, 8.5, "MIROC5")


# Historical

max_hast_hmettot_hist_monthly <- rbind(proj01_hast_hmettot, proj02_hast_hmettot, 
                           proj03_hast_hmettot, proj04_hast_hmettot, 
                           proj05_hast_hmettot, proj06_hast_hmettot, 
                           proj07_hast_hmettot, proj08_hast_hmettot, 
                           proj09_hast_hmettot, proj10_hast_hmettot, 
                           proj11_hast_hmettot, proj12_hast_hmettot, 
                           proj13_hast_hmettot, proj14_hast_hmettot, 
                           proj15_hast_hmettot, proj16_hast_hmettot) %>% 
  filter(YEAR > 1979) %>% 
  filter(YEAR < 2010) %>% 
  mutate(proj_year = as.factor(1995)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))


# 2030
max_hast_hmettot_2030_monthly <- rbind(proj01_hast_hmettot, proj02_hast_hmettot, 
                           proj03_hast_hmettot, proj04_hast_hmettot, 
                           proj05_hast_hmettot, proj06_hast_hmettot, 
                           proj07_hast_hmettot, proj08_hast_hmettot, 
                           proj09_hast_hmettot, proj10_hast_hmettot, 
                           proj11_hast_hmettot, proj12_hast_hmettot, 
                           proj13_hast_hmettot, proj14_hast_hmettot, 
                           proj15_hast_hmettot, proj16_hast_hmettot) %>% 
  filter(YEAR > 2014) %>% 
  filter(YEAR < 2045) %>% 
  mutate(proj_year = as.factor(2030)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))


# 2050
max_hast_hmettot_2050_monthly <- rbind(proj01_hast_hmettot, proj02_hast_hmettot, 
                           proj03_hast_hmettot, proj04_hast_hmettot, 
                           proj05_hast_hmettot, proj06_hast_hmettot, 
                           proj07_hast_hmettot, proj08_hast_hmettot, 
                           proj09_hast_hmettot, proj10_hast_hmettot, 
                           proj11_hast_hmettot, proj12_hast_hmettot, 
                           proj13_hast_hmettot, proj14_hast_hmettot, 
                           proj15_hast_hmettot, proj16_hast_hmettot) %>% 
  filter(YEAR > 2034) %>% 
  filter(YEAR < 2065) %>% 
  mutate(proj_year = as.factor(2050)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))


# 2085
max_hast_hmettot_2085_monthly <- rbind(proj01_hast_hmettot, proj02_hast_hmettot, 
                           proj03_hast_hmettot, proj04_hast_hmettot, 
                           proj05_hast_hmettot, proj06_hast_hmettot, 
                           proj07_hast_hmettot, proj08_hast_hmettot, 
                           proj09_hast_hmettot, proj10_hast_hmettot, 
                           proj11_hast_hmettot, proj12_hast_hmettot, 
                           proj13_hast_hmettot, proj14_hast_hmettot, 
                           proj15_hast_hmettot, proj16_hast_hmettot) %>% 
  filter(YEAR > 2069) %>% 
  filter(YEAR < 2100) %>% 
  mutate(proj_year = as.factor(2085)) %>% 
  mutate(PROJ = as.factor(PROJ)) %>% 
  mutate(RCP = as.factor(RCP)) %>% 
  mutate(GCM = as.factor(GCM))
  

        

```


## Figures

```{r}

all_monthly_hast_models <- rbind(max_hast_hmettot_hist_monthly, max_hast_hmettot_2030_monthly, max_hast_hmettot_2050_monthly,max_hast_hmettot_2085_monthly)

plot_proj_year_hast_monthly <- ggplot(all_monthly_hast_models, aes(HAST_HMETTOTmax, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by Projection Period for All Models - Monthly HAST + HMETTOT Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("hast + hmettot monthly max figs/overall_monthly.png")


plot_proj_year_hast_monthly

plot_proj_year_hast_monthly_GCMfacet <- ggplot(all_monthly_hast_models, aes(HAST_HMETTOTmax, colour = proj_year)) + stat_ecdf(geom="step", pad = FALSE) +
  facet_wrap(~GCM) +
  ggtitle("CDF by Projection Period for All Models - Monthly HAST + HMETTOT Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("hast + hmettot monthly max figs/overall_monthly_GCMfacet.png")


plot_by_RCP <- ggplot(all_monthly_hast_models, aes(HAST_HMETTOTmax, colour = RCP)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by RCP Model - Monthly HAST + HMETTOT Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("hast + hmettot monthly max figs/overall_monthly_RCP.png")


plot_by_RCP

plot_by_GCM <- ggplot(all_monthly_hast_models, aes(HAST_HMETTOTmax, colour = GCM)) + stat_ecdf(geom="step", pad = FALSE) +
  ggtitle("CDF by GCM Model - Monthly HAST + HMETTOT Maximums") +
  ylab("Non-exceedence probability") +
  xlab("Meters above mean sea level ") +
  theme_bw() +
  ggsave("hast + hmettot monthly max figs/overall_monthly_GCM.png")

```


## Significance testing for HAST + HMETTOT



```{r}


proj01_hh <- proj01_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("01" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj02_hh <- proj02_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("02" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj03_hh <- proj03_hast_hmettot %>%
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("03" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj04_hh <- proj04_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("04" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj05_hh <- proj05_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("05" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj06_hh <- proj06_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("06" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj07_hh <- proj07_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("07" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj08_hh <- proj08_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("08" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj09_hh <- proj09_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("09" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj10_hh <- proj10_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("10" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj11_hh <- proj11_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("11" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj12_hh <- proj12_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("12" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj13_hh <- proj13_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("13" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj14_hh <- proj14_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("14" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj15_hh <- proj15_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("15" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)

proj16_hh <- proj16_hast_hmettot %>% 
  select(YEAR, MONTH, HAST_HMETTOTmax) %>% 
  rename("16" = HAST_HMETTOTmax) %>% 
  filter(YEAR > 1999)




# Combine all separate dfs into one, with each column representing mean HMETTOT by year for each model (WIDE)

hast_monthly_combined <- left_join(proj01_hh, proj02_hh, by = c("YEAR", "MONTH")) %>% 
  left_join(proj03_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj04_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj05_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj06_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj07_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj08_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj09_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj10_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj11_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj12_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj13_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj14_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj15_hh, by=c("YEAR", "MONTH")) %>% 
  left_join(proj16_hh, by=c("YEAR", "MONTH"))



```

## Linear regression and significance testing for HAST + HMETTOT monthly maxima
*not sure how to make month and year a single independent variable?*

```{r}

lapply(hast_monthly_combined[-2], function(x) summary(lm(x ~ hast_monthly_combined$MONTH)))

lapply(mean_annual_combined[-1], function(x) cor.test(x, mean_annual_combined$YEAR, method="kendall"))


```



